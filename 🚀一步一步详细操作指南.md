# 🚀 一步一步详细操作指南

## 📋 完整流程：从推送代码到部署成功

这个指南会详细指导你完成每一步操作。

---

## ✅ 第一部分：推送代码到 GitHub

### 步骤 1：打开终端/命令行

1. **在项目文件夹中打开终端**
   - 方法 1：在文件夹中按住 `Shift` 键，然后右键点击空白处，选择"在此处打开 PowerShell 窗口"
   - 方法 2：打开 PowerShell 或命令提示符，然后运行：
     ```bash
     cd "C:\Users\26872\Desktop\心理网站编写\02 管理器 - 副本 - 副本"
     ```

2. **确认你在正确的目录**
   - 运行：`pwd` 或 `cd`
   - 应该显示项目目录路径

### 步骤 2：检查 Git 状态

1. **运行以下命令：**
   ```bash
   git status
   ```

2. **查看输出结果：**
   - 会显示哪些文件已跟踪
   - 会显示哪些文件未跟踪（需要添加）
   - 会显示哪些文件已修改

3. **预期结果示例：**
   ```
   On branch main
   Changes not staged for commit:
     (use "git add <file>..." to update what will be committed)
     ...
   ```

### 步骤 3：添加所有文件

1. **运行以下命令：**
   ```bash
   git add .
   ```

2. **这个命令会：**
   - ✅ 添加所有未跟踪的文件
   - ✅ 添加所有修改的文件
   - ❌ 不会添加 `.gitignore` 中忽略的文件（如 `node_modules/`、`dist/`）

3. **等待命令完成**
   - 通常只需要几秒钟

### 步骤 4：再次检查状态（确认添加成功）

1. **运行：**
   ```bash
   git status
   ```

2. **确认看到：**
   - ✅ `src/` 文件夹被添加
   - ✅ `functions/` 文件夹被添加
   - ✅ `public/` 文件夹被添加
   - ✅ 各种配置文件被添加
   - ❌ 没有 `node_modules/`
   - ❌ 没有 `dist/`

3. **示例输出：**
   ```
   Changes to be committed:
     new file:   src/...
     new file:   functions/_middleware.js
     new file:   public/_redirects
     ...
   ```

### 步骤 5：提交更改

1. **运行以下命令：**
   ```bash
   git commit -m "添加完整项目代码和配置"
   ```

2. **或者使用更详细的提交信息：**
   ```bash
   git commit -m "添加完整项目代码和配置

   - 添加源代码和组件
   - 添加 Functions 中间件
   - 添加构建配置和脚本
   - 添加公共文件（_redirects 等）"
   ```

3. **等待提交完成**
   - 可能会显示添加的文件列表
   - 显示类似：`X files changed, Y insertions(+)`

### 步骤 6：推送到 GitHub

1. **运行以下命令：**
   ```bash
   git push origin main
   ```

2. **如果提示分支不存在，先查看分支：**
   ```bash
   git branch
   ```
   - 如果显示 `master` 而不是 `main`，使用：
     ```bash
     git push origin master
     ```

3. **如果需要设置上游分支：**
   - 如果提示需要设置上游，运行：
     ```bash
     git push -u origin main
     ```
     或
     ```bash
     git push -u origin master
     ```

4. **如果提示需要认证：**
   - 可能需要输入 GitHub 用户名
   - 然后输入密码或 Personal Access Token

5. **等待推送完成**
   - 会显示推送进度
   - 完成后显示类似：`To https://github.com/... X objects pushed.`

### 步骤 7：验证推送成功

1. **打开浏览器**

2. **访问 GitHub 仓库：**
   - https://github.com/yo385042-blip/mindcube

3. **刷新页面**（按 `F5` 或点击刷新按钮）

4. **检查仓库内容：**
   - 应该看到最新的提交
   - 应该看到 `src/` 文件夹
   - 应该看到 `functions/` 文件夹（在根目录）
   - 应该看到 `public/` 文件夹
   - 应该看到 `package.json`
   - 不应该看到 `dist/` 文件夹
   - 不应该看到 `node_modules/` 文件夹

5. **如果看到这些文件，✅ 第一部分完成！**

---

## ✅ 第二部分：配置 Cloudflare Pages 构建

### 步骤 8：登录 Cloudflare Dashboard

1. **打开浏览器**

2. **访问 Cloudflare Dashboard：**
   - https://dash.cloudflare.com/

3. **登录你的账户**
   - 输入邮箱和密码
   - 点击登录

### 步骤 9：进入 Pages 项目

1. **在左侧菜单中，找到并点击：**
   - **"Workers & Pages"** 或 **"Workers 和 Pages"**

2. **点击你的项目**
   - 可能是 `psytest.store` 或 `mindcube`
   - 在项目列表中点击项目名称

### 步骤 10：进入设置页面

1. **在项目页面顶部，你会看到几个标签：**
   - 资产已上传
   - 函数
   - 重定向
   - 标头
   - **设置** ← **点击这个！**

2. **点击 "设置" (Settings) 标签**

### 步骤 11：找到构建设置

1. **在设置页面中，查找以下选项之一：**
   - **"Builds & deployments"**
   - **"构建和部署"**
   - **"Build configuration"**
   - **"构建配置"**

2. **可能的位置：**
   - 左侧菜单中
   - 页面中间部分
   - 在设置页面的主要区域

3. **找到后，点击进入构建配置部分**

### 步骤 12：配置构建命令

1. **找到 "Build command" 或 "构建命令" 输入框**

2. **在输入框中输入：**
   ```
   npm run build
   ```

3. **确认输入正确**
   - 不要有多余的空格
   - 确保拼写正确

### 步骤 13：配置构建输出目录

1. **找到 "Output directory" 或 "构建输出目录" 输入框**

2. **在输入框中输入：**
   ```
   dist
   ```

3. **确认输入正确**
   - 小写字母
   - 不要有多余的空格

### 步骤 14：配置根目录

1. **找到 "Root directory" 或 "根目录" 输入框**

2. **留空**（不输入任何内容）
   - 这表示使用项目根目录
   - 或者输入：`/` 或 `.`

### 步骤 15：配置框架预设（如果有）

1. **找到 "Framework preset" 或 "框架预设" 下拉菜单**

2. **选择：**
   - **None**（无）
   - 或者 **Vite**（也可以，但推荐 None）

### 步骤 16：配置 Node.js 版本

1. **找到 "Node.js version" 或 "Node.js 版本" 下拉菜单**

2. **选择：**
   - **18**（推荐）
   - 或 **20**

### 步骤 17：最终确认配置

**确认所有设置如下：**

```
框架预设：None（或无）
构建命令：npm run build
构建输出目录：dist
根目录：（留空或 /）
Node.js 版本：18
```

### 步骤 18：保存设置

1. **滚动到页面底部**

2. **找到 "保存" (Save) 按钮**
   - 通常是绿色或蓝色的按钮

3. **点击 "保存" (Save) 按钮**

4. **等待保存完成**
   - 页面可能会刷新
   - 或显示 "设置已保存" 的提示

5. **如果看到保存成功的提示，✅ 第二部分完成！**

---

## ✅ 第三部分：触发重新部署

### 步骤 19：选择触发方式

**有两种方式，选择其中一种：**

---

### 方式 A：推送新提交（推荐）

#### 步骤 19A-1：创建空提交

1. **在终端/命令行中，确保在项目目录**

2. **运行以下命令：**
   ```bash
   git commit --allow-empty -m "触发 Cloudflare Pages 重新构建"
   ```

3. **等待提交完成**

#### 步骤 19A-2：推送到 GitHub

1. **运行以下命令：**
   ```bash
   git push origin main
   ```
   或（如果分支是 master）：
   ```bash
   git push origin master
   ```

2. **等待推送完成**

#### 步骤 19A-3：等待自动部署

1. **Cloudflare Pages 会自动检测新提交**
2. **自动开始构建和部署**
3. **通常需要 2-5 分钟**

---

### 方式 B：手动重新部署

#### 步骤 19B-1：进入部署页面

1. **在 Cloudflare Pages 项目页面**
2. **点击顶部的 "部署" (Deployments) 标签**

#### 步骤 19B-2：找到最新部署

1. **在部署列表中，找到最新的部署**
2. **点击部署右侧的三个点（...）菜单**

#### 步骤 19B-3：重新部署

1. **在菜单中，点击：**
   - **"重新部署"** (Retry deployment)
   - 或 **"Retry build"**

2. **等待部署开始**

---

## ✅ 第四部分：验证部署

### 步骤 20：查看构建日志

1. **在 Cloudflare Pages 项目页面**
2. **点击 "部署" (Deployments) 标签**
3. **点击最新的部署**

### 步骤 21：检查构建日志内容

**在构建日志中，应该看到以下步骤：**

#### ✅ 步骤 1：克隆仓库
```
Cloning repository...
From https://github.com/yo385042-blip/mindcube
Success: Finished cloning repository files
```

#### ✅ 步骤 2：安装依赖
```
Installing dependencies...
Running npm install...
```

#### ✅ 步骤 3：运行构建命令
```
Running build command...
> npm run build
```

#### ✅ 步骤 4：构建输出
```
✓ TypeScript compilation
✓ Vite build
✓ Functions directory copied to dist successfully!
```

#### ✅ 步骤 5：部署成功
```
Success: Assets published!
Success: Your site was deployed!
```

### 步骤 22：确认没有错误

**确认日志中**：
- ❌ **没有** "No build command specified"
- ❌ **没有** "No functions dir found"
- ✅ **有** "Running build command"
- ✅ **有** "Functions directory copied"

### 步骤 23：检查 Functions

1. **在部署详情页面**
2. **点击顶部的 "函数" (Functions) 标签**

3. **应该看到：**
   - ✅ `_middleware.js` 函数
   - ✅ 状态为 Active 或 Deployed
   - ✅ 没有错误信息

4. **如果看到了，✅ 部署成功！**

---

## ✅ 第五部分：测试网站

### 步骤 24：找到网站 URL

1. **在部署详情页面**
2. **查找网站 URL**
   - 通常在页面顶部
   - 或显示为：`https://psytest.store.pages.dev`
   - 或：`https://mindcube-xxxxx.pages.dev`

3. **复制 URL**

### 步骤 25：访问网站

1. **在浏览器中打开新标签页**
2. **粘贴并访问网站 URL**
3. **等待页面加载**

### 步骤 26：测试首页

1. **检查首页是否能正常打开**
   - ✅ 页面是否加载？
   - ✅ 是否显示内容？
   - ✅ 是否有错误？

2. **如果有错误，记下错误信息**

### 步骤 27：测试路由

1. **测试登录页面：**
   - 在地址栏输入：`你的网站URL/login`
   - 例如：`https://psytest.store.pages.dev/login`
   - 按 Enter
   - ✅ 是否能正常打开？

2. **测试仪表盘页面：**
   - 在地址栏输入：`你的网站URL/dashboard`
   - 例如：`https://psytest.store.pages.dev/dashboard`
   - 按 Enter
   - ✅ 是否能正常打开？（可能需要先登录）

3. **测试其他路由（如果需要）**

### 步骤 28：最终验证

**如果以下都正常，✅ 全部完成！**

- [ ] ✅ 网站能正常打开
- [ ] ✅ 首页正常显示
- [ ] ✅ 路由能正常访问（`/login`、`/dashboard` 等）
- [ ] ✅ 没有错误页面
- [ ] ✅ 功能正常工作

---

## 🎉 完成！

如果所有步骤都完成了，恭喜你！

你的网站现在应该：
- ✅ 自动部署（每次推送代码都会自动构建和部署）
- ✅ Functions 正常工作
- ✅ 路由正常工作
- ✅ 网站完全正常运行

---

## 💡 后续维护

之后每次更新网站：

1. **修改代码**
2. **提交更改：**
   ```bash
   git add .
   git commit -m "描述你的更改"
   git push origin main
   ```
3. **Cloudflare Pages 自动部署**（通常 2-5 分钟）

---

## 📞 如果遇到问题

如果在任何步骤遇到问题：

1. **记录错误信息**
2. **告诉我你在哪一步**
3. **告诉我具体的错误信息**
4. **我会帮你解决问题**

现在就按照这个指南一步一步执行吧！

