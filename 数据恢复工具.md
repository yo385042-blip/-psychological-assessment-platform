# 数据恢复工具指南

## 🔍 检查数据是否丢失

### 方法1：检查浏览器 localStorage

1. **打开浏览器开发者工具**
   - 按 `F12` 或右键点击页面选择"检查"
   - 切换到 "Application" 标签（Chrome）或 "存储" 标签（Firefox）

2. **检查 LocalStorage**
   - 在左侧找到 "Local Storage"
   - 点击你的网站域名
   - 查看以下键名是否有数据：
     - `test_links` - 测试链接数据
     - `custom_users` - 注册用户数据
     - `audit_logs` - 操作日志
     - `system_backups` - 备份数据
     - `question_import_custom_types` - 题目类型
     - `question_publish_state` - 题目发布状态
     - `question_import_history` - 导入历史

### 方法2：使用数据恢复工具

在浏览器控制台（Console）中运行以下代码：

```javascript
// 检查所有 localStorage 数据
console.log('=== 数据检查 ===')
const keys = [
  'test_links',
  'custom_users',
  'audit_logs',
  'system_backups',
  'question_import_custom_types',
  'question_publish_state',
  'question_import_history',
  'default_accounts_quota',
  'default_accounts_used_quota',
  'default_accounts_total_quota',
  'default_accounts_recharge',
  'default_accounts_login_times'
]

keys.forEach(key => {
  const data = localStorage.getItem(key)
  if (data) {
    try {
      const parsed = JSON.parse(data)
      console.log(`✓ ${key}:`, Array.isArray(parsed) ? `${parsed.length} 条记录` : '有数据')
    } catch {
      console.log(`✓ ${key}: 有数据（非JSON）`)
    }
  } else {
    console.log(`✗ ${key}: 无数据`)
  }
})
```

---

## 🔄 恢复数据的方法

### 方法1：从备份恢复（如果有备份）

1. **进入数据备份页面**
   - 登录管理员账号
   - 访问：`/admin/backup`

2. **恢复备份**
   - 找到之前的备份记录
   - 点击"恢复"按钮
   - 确认恢复（会覆盖当前数据）

### 方法2：从导出的 JSON 文件恢复

如果你之前导出过备份文件：

1. **进入数据备份页面**
   - 访问：`/admin/backup`

2. **导入备份**
   - 点击"导入备份"按钮
   - 选择之前导出的 JSON 文件
   - 确认导入

### 方法3：手动恢复（如果有备份数据）

如果你有备份的 JSON 数据，可以在浏览器控制台运行：

```javascript
// 恢复链接数据
const linksData = [/* 你的链接数据 */]
localStorage.setItem('test_links', JSON.stringify(linksData))
window.dispatchEvent(new Event('links-updated'))

// 恢复用户数据
const usersData = [/* 你的用户数据 */]
localStorage.setItem('custom_users', JSON.stringify(usersData))

// 恢复操作日志
const logsData = [/* 你的日志数据 */]
localStorage.setItem('audit_logs', JSON.stringify(logsData))
window.dispatchEvent(new Event('audit-logs-updated'))
```

---

## 🛡️ 预防数据丢失

### 1. 定期创建备份

- 进入 `/admin/backup` 页面
- 点击"创建备份"
- 输入备份名称和描述
- 定期导出备份文件到本地

### 2. 导出备份文件

- 在备份列表中点击"导出"
- 保存 JSON 文件到安全位置

### 3. 检查浏览器存储限制

- 某些浏览器可能限制 localStorage 大小（通常 5-10MB）
- 如果数据过多，考虑清理旧数据

---

## 🔧 常见问题

### Q: 数据突然消失了？

**可能原因：**
1. 浏览器缓存被清除
2. localStorage 被其他程序清除
3. 浏览器隐私模式或隐身模式
4. 浏览器更新导致数据丢失

**解决方案：**
- 检查是否有备份
- 检查浏览器是否开启了"关闭时清除数据"
- 检查是否有浏览器扩展清除了数据

### Q: 如何防止数据丢失？

**建议：**
1. 定期创建备份（每周至少一次）
2. 导出备份文件到本地
3. 不要使用隐私模式或隐身模式
4. 不要清除浏览器缓存和数据

### Q: 数据可以恢复吗？

**如果：**
- ✅ 有备份文件 → 可以恢复
- ✅ 有导出的 JSON → 可以导入
- ✅ 浏览器缓存未清除 → 可能还在 localStorage
- ❌ 没有备份且缓存已清除 → 无法恢复

---

## 📞 需要帮助？

如果数据无法恢复，请：
1. 检查浏览器控制台是否有错误信息
2. 检查是否有备份文件
3. 联系技术支持并提供详细信息


