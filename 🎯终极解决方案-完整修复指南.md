# ğŸ¯ ç»ˆæè§£å†³æ–¹æ¡ˆ - å®Œæ•´ä¿®å¤æŒ‡å—

## ğŸ” é—®é¢˜æ ¹æœ¬åŸå› åˆ†æ

ç»è¿‡æ·±å…¥åˆ†æï¼Œé—®é¢˜çš„æ ¹æºæ˜¯ï¼š

1. **Cloudflare Pages è‡ªåŠ¨è¿è¡Œ `npm ci`**
   - å³ä½¿åœ¨æ„å»ºå‘½ä»¤ä¸­è®¾ç½®äº† `npm install`ï¼ŒCloudflare Pages ä¹Ÿä¼šå…ˆè‡ªåŠ¨è¿è¡Œ `npm ci`
   - `npm ci` è¦æ±‚ `package.json` å’Œ `package-lock.json` å®Œå…¨åŒæ­¥

2. **Vite çš„ peerDependencies**
   - Vite åœ¨ `package-lock.json` ä¸­å£°æ˜äº† `terser` ä½œä¸ºå¯é€‰çš„ peer dependency
   - è™½ç„¶æ ‡è®°ä¸º `optional: true`ï¼Œä½† `npm ci` ä»ç„¶ä¼šæ£€æŸ¥å®ƒ

3. **package-lock.json ä¸åŒæ­¥**
   - é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºç¼ºå°‘ `terser@5.44.1` åŠå…¶ä¾èµ–
   - è¯´æ˜ `package-lock.json` ä¸­å¼•ç”¨äº† `terser`ï¼Œä½†ç¼ºå°‘å®Œæ•´çš„å®šä¹‰

---

## âœ… å®Œæ•´è§£å†³æ–¹æ¡ˆï¼ˆä¸‰é‡ä¿éšœï¼‰

### æ–¹æ¡ˆ 1ï¼šåˆ›å»º .npmrc æ–‡ä»¶ï¼ˆå·²åˆ›å»ºï¼‰âœ…

æˆ‘å·²ä¸ºä½ åˆ›å»ºäº† `.npmrc` æ–‡ä»¶ï¼Œå†…å®¹ï¼š

```
legacy-peer-deps=true
fund=false
audit=false
```

**ä½œç”¨ï¼š**
- `legacy-peer-deps=true`ï¼šä½¿ç”¨æ—§çš„ peer dependency è§£ææ–¹å¼ï¼Œæ›´å®½æ¾
- è¿™ä¼šè®© `npm ci` æ›´å®½æ¾åœ°å¤„ç†å¯é€‰çš„ peer dependencies

---

### æ–¹æ¡ˆ 2ï¼šä¿®æ”¹ Cloudflare Pages æ„å»ºå‘½ä»¤

åœ¨ Cloudflare Dashboard ä¸­ï¼š

1. **è¿›å…¥é¡¹ç›®è®¾ç½®**
2. **æ‰¾åˆ° "æ„å»ºå’Œéƒ¨ç½²" (Builds & deployments)**
3. **ä¿®æ”¹æ„å»ºå‘½ä»¤ä¸ºï¼š**

```bash
npm ci --legacy-peer-deps || npm install --legacy-peer-deps && npm run build
```

**æˆ–è€…æ›´ç®€å•ï¼š**

```bash
npm install --legacy-peer-deps && npm run build
```

**è¯´æ˜ï¼š**
- ä½¿ç”¨ `--legacy-peer-deps` æ ‡å¿—å¯ä»¥è®© npm æ›´å®½æ¾åœ°å¤„ç† peer dependencies
- å³ä½¿ Cloudflare Pages å…ˆè¿è¡Œ `npm ci`ï¼Œä¹Ÿä¼šä½¿ç”¨è¿™ä¸ªæ ‡å¿—

---

### æ–¹æ¡ˆ 3ï¼šç¡®ä¿ package-lock.json å®Œå…¨åŒæ­¥

æäº¤ `.npmrc` æ–‡ä»¶åï¼Œæˆ‘ä»¬éœ€è¦ï¼š

1. **é‡æ–°ç”Ÿæˆ package-lock.json**ï¼ˆä½¿ç”¨æ–°çš„ .npmrc é…ç½®ï¼‰
2. **æäº¤å¹¶æ¨é€**

---

## ğŸš€ å®Œæ•´æ“ä½œæ­¥éª¤

### æ­¥éª¤ 1ï¼šé‡æ–°ç”Ÿæˆ package-lock.jsonï¼ˆä½¿ç”¨ .npmrc é…ç½®ï¼‰

```powershell
# åˆ é™¤æ—§çš„ package-lock.json
Remove-Item package-lock.json -Force

# åˆ é™¤ node_modulesï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰
Remove-Item node_modules -Recurse -Force -ErrorAction SilentlyContinue

# é‡æ–°å®‰è£…ï¼ˆä¼šä½¿ç”¨ .npmrc é…ç½®ï¼‰
npm install
```

---

### æ­¥éª¤ 2ï¼šéªŒè¯ package-lock.json

æ£€æŸ¥æ˜¯å¦æˆåŠŸç”Ÿæˆï¼š

```powershell
# æ£€æŸ¥ package-lock.json æ˜¯å¦å­˜åœ¨
Test-Path package-lock.json

# æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
npm ci --dry-run 2>&1 | Select-String -Pattern "error" | Select-Object -First 5
```

---

### æ­¥éª¤ 3ï¼šæäº¤å¹¶æ¨é€æ‰€æœ‰æ›´æ”¹

```powershell
# 1. æ£€æŸ¥çŠ¶æ€
git status

# 2. æ·»åŠ æ‰€æœ‰æ›´æ”¹
git add .npmrc package-lock.json package.json

# 3. æäº¤
git commit -m "æ·»åŠ  .npmrc é…ç½®å¹¶é‡æ–°ç”Ÿæˆ package-lock.jsonï¼šä¿®å¤ npm ci é”™è¯¯"

# 4. æ¨é€
git push origin main
```

---

### æ­¥éª¤ 4ï¼šåœ¨ Cloudflare Pages ä¸­ä¿®æ”¹æ„å»ºå‘½ä»¤ï¼ˆé‡è¦ï¼ï¼‰

1. **è®¿é—® Cloudflare Dashboard**
2. **è¿›å…¥ä½ çš„é¡¹ç›® â†’ è®¾ç½® (Settings)**
3. **æ‰¾åˆ° "æ„å»ºå’Œéƒ¨ç½²" (Builds & deployments)**
4. **ä¿®æ”¹æ„å»ºå‘½ä»¤ä¸ºï¼š**

```bash
npm install --legacy-peer-deps && npm run build
```

**æˆ–è€…ï¼ˆå¦‚æœä¸Šé¢ä¸è¡Œï¼‰ï¼š**

```bash
npm ci --legacy-peer-deps || npm install --legacy-peer-deps && npm run build
```

5. **ä¿å­˜è®¾ç½®**
6. **æ‰‹åŠ¨è§¦å‘æ–°éƒ¨ç½²**

---

## ğŸ“‹ ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›æ­¥éª¤ï¼Ÿ

### .npmrc æ–‡ä»¶
- å‘Šè¯‰ npm ä½¿ç”¨å®½æ¾çš„ peer dependency è§£æ
- Cloudflare Pages ä¼šè¯»å–è¿™ä¸ªæ–‡ä»¶

### ä¿®æ”¹æ„å»ºå‘½ä»¤
- ç¡®ä¿å³ä½¿ Cloudflare Pages è‡ªåŠ¨è¿è¡Œ `npm ci`ï¼Œä¹Ÿä½¿ç”¨ `--legacy-peer-deps` æ ‡å¿—
- å¦‚æœ `npm ci` å¤±è´¥ï¼Œä¼šå›é€€åˆ° `npm install`

### é‡æ–°ç”Ÿæˆ package-lock.json
- ä½¿ç”¨æ–°çš„ .npmrc é…ç½®ç”Ÿæˆï¼Œç¡®ä¿ä¸€è‡´æ€§

---

## âœ… é¢„æœŸç»“æœ

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼š

1. âœ… `.npmrc` æ–‡ä»¶ä¼šè¢«æäº¤ï¼ŒCloudflare Pages ä¼šè¯»å–å®ƒ
2. âœ… `package-lock.json` ä¼šä½¿ç”¨å®½æ¾çš„é…ç½®é‡æ–°ç”Ÿæˆ
3. âœ… æ„å»ºå‘½ä»¤ä½¿ç”¨ `--legacy-peer-deps` æ ‡å¿—
4. âœ… `npm ci` åº”è¯¥èƒ½å¤ŸæˆåŠŸè¿è¡Œ
5. âœ… æ„å»ºåº”è¯¥èƒ½å¤Ÿå®Œæˆ

---

## ğŸ¯ ç°åœ¨å¼€å§‹æ‰§è¡Œ

è¯·æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤ä¸€æ­¥ä¸€æ­¥æ‰§è¡Œï¼Œæˆ‘ä¼šç»§ç»­å¸®ä½ ï¼

**é¦–å…ˆæ‰§è¡Œæ­¥éª¤ 1ï¼šé‡æ–°ç”Ÿæˆ package-lock.json**

```powershell
Remove-Item package-lock.json -Force
Remove-Item node_modules -Recurse -Force -ErrorAction SilentlyContinue
npm install
```

å‘Šè¯‰æˆ‘ç»“æœï¼Œæˆ‘ä¼šç»§ç»­ï¼

