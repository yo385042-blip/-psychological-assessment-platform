# 📋 长期方案：完整详细步骤指南

## 🎯 目标

配置完整的 Git 集成部署，让 Cloudflare Pages 自动构建和部署项目。

---

## 📋 步骤 1：检查当前状态

### 1.1 检查本地项目

你的本地项目应该包含：

```
项目根目录/
├── src/                 ✅ 源代码
├── functions/           ✅ Functions 中间件
│   └── _middleware.js
├── public/              ✅ 公共文件
│   ├── _redirects
│   └── logo-cube.jpg
├── scripts/             ✅ 构建脚本
│   └── copy-functions.js
├── package.json         ✅ 依赖配置
├── vite.config.ts       ✅ Vite 配置
├── tsconfig.json        ✅ TypeScript 配置
└── dist/                ⚠️ 构建输出（不应该提交）
```

### 1.2 检查 GitHub 仓库

1. **访问你的 GitHub 仓库**
   - https://github.com/yo385042-blip/mindcube

2. **检查仓库内容**
   - 查看有哪些文件和文件夹
   - 确认是否包含源代码（`src/` 文件夹）
   - 确认是否包含 `functions/` 文件夹（在根目录）
   - 确认是否有 `package.json`

---

## 📋 步骤 2：准备 Git 仓库

### 2.1 创建 .gitignore 文件（如果还没有）

在项目根目录创建或检查 `.gitignore` 文件，确保包含：

```gitignore
# 依赖
node_modules/
package-lock.json

# 构建输出
dist/
dist.zip

# 环境变量
.env
.env.local

# 编辑器
.vscode/
.idea/
*.swp
*.swo

# 系统文件
.DS_Store
Thumbs.db

# 日志
*.log
npm-debug.log*
```

**说明：**
- `dist/` 应该被忽略，因为 Cloudflare Pages 会自动构建
- `node_modules/` 应该被忽略，因为会通过 `npm install` 安装

### 2.2 检查 Git 状态

在项目目录打开终端/命令行，运行：

```bash
# 检查当前状态
git status
```

查看：
- ✅ 哪些文件已跟踪
- ✅ 哪些文件未跟踪
- ✅ 是否有修改未提交

---

## 📋 步骤 3：推送完整代码到 GitHub

### 3.1 添加所有文件（除了忽略的）

```bash
# 在项目目录运行

# 添加所有文件
git add .
```

**这会添加：**
- ✅ 源代码（`src/`）
- ✅ Functions（`functions/`）
- ✅ 配置文件（`package.json`、`vite.config.ts` 等）
- ✅ 公共文件（`public/`）
- ❌ 不会添加 `node_modules/`（已在 `.gitignore`）
- ❌ 不会添加 `dist/`（已在 `.gitignore`）

### 3.2 提交更改

```bash
# 提交所有更改
git commit -m "添加完整项目代码和配置文件

- 添加源代码和组件
- 添加 Functions 中间件
- 添加构建配置
- 添加公共文件（_redirects 等）"
```

### 3.3 推送到 GitHub

```bash
# 推送到 GitHub
git push origin main
```

**或者如果是其他分支：**

```bash
# 查看当前分支
git branch

# 推送到对应分支（例如 master）
git push origin master
```

### 3.4 验证推送

1. **访问 GitHub 仓库**
   - https://github.com/yo385042-blip/mindcube

2. **刷新页面**
   - 确认看到新提交

3. **检查文件结构**
   - 确认有 `src/` 文件夹
   - 确认有 `functions/` 文件夹（在根目录）
   - 确认有 `package.json`
   - 确认有 `public/_redirects`
   - 确认**没有** `dist/` 文件夹（应该被忽略）

---

## 📋 步骤 4：配置 Cloudflare Pages 构建

### 4.1 进入项目设置

1. **登录 Cloudflare Dashboard**
   - https://dash.cloudflare.com/

2. **进入 Pages 项目**
   - Workers & Pages → 你的项目（psytest.store 或 mindcube）

3. **进入设置**
   - 点击 **"设置"** (Settings) 标签

### 4.2 配置构建设置

1. **找到构建和部署部分**
   - 查找 **"Builds & deployments"** 或 **"构建和部署"**
   - 可能在左侧菜单或页面中间

2. **配置构建命令**
   - **框架预设：** None 或 Vite（可以选 None，手动配置）
   - **构建命令：** `npm run build`
   - **构建输出目录：** `dist`
   - **根目录：** （留空，使用项目根目录）

3. **配置环境变量（可选）**
   - 如果项目需要环境变量，在这里添加
   - 当前项目可能不需要

4. **配置 Node.js 版本**
   - 选择 Node.js 版本：**18** 或 **20**（推荐 18）

5. **保存设置**
   - 点击 **"保存"** 或 **"Save"** 按钮

### 4.3 验证配置

配置后，设置应该显示：

```
构建命令：npm run build
构建输出目录：dist
根目录：（留空）
Node.js 版本：18
```

---

## 📋 步骤 5：触发重新部署

### 方法 1：推送新提交（推荐）

推送一个新提交，Cloudflare Pages 会自动触发构建：

```bash
# 在项目目录运行

# 1. 做一个小改动（例如添加一个注释）
# 或者直接推送空提交

# 2. 提交
git commit --allow-empty -m "触发 Cloudflare Pages 重新构建"

# 3. 推送
git push origin main
```

### 方法 2：手动重新部署

1. **进入部署页面**
   - Cloudflare Pages → 你的项目 → Deployments

2. **找到最新部署**
   - 点击部署右侧的三个点（...）

3. **选择重新部署**
   - 点击 **"重新部署"** 或 **"Retry deployment"**

---

## 📋 步骤 6：验证部署

### 6.1 查看构建日志

1. **进入最新部署**
   - Deployments → 点击最新部署

2. **查看构建日志**
   - 应该看到：
     - ✅ 克隆仓库
     - ✅ 安装依赖（`npm install`）
     - ✅ 运行构建命令（`npm run build`）
     - ✅ 复制 Functions 目录
     - ✅ 部署成功

3. **检查关键信息**
   - ✅ 没有 "No build command specified"
   - ✅ 没有 "No functions dir found"
   - ✅ 显示构建成功

### 6.2 检查 Functions

1. **点击 "函数" (Functions) 标签**
   - 应该能看到 `_middleware.js`

2. **检查状态**
   - 应该显示为 Active 或 Deployed

### 6.3 检查重定向

1. **点击 "重定向" (Redirects) 标签**
   - 检查是否有路由配置
   - 或者 `_redirects` 文件是否被处理

---

## 📋 步骤 7：测试网站

### 7.1 访问网站

1. **找到网站 URL**
   - 在部署详情页面查看
   - 通常是 `https://psytest.store.pages.dev` 或类似

2. **访问网站**
   - 在浏览器中打开 URL

### 7.2 测试功能

1. **测试首页**
   - ✅ 是否能正常打开？
   - ✅ 页面是否正常显示？

2. **测试路由**
   - ✅ `/login` 是否能访问？
   - ✅ `/dashboard` 是否能访问？
   - ✅ 其他路由是否正常？

3. **测试功能**
   - ✅ 登录功能是否正常？
   - ✅ 页面功能是否正常？

---

## 📋 步骤 8：后续维护

### 8.1 自动部署流程

配置完成后，每次推送代码到 GitHub：

1. **本地修改代码**
2. **提交更改**
   ```bash
   git add .
   git commit -m "描述你的更改"
   git push origin main
   ```
3. **Cloudflare Pages 自动部署**
   - 会自动检测新提交
   - 会自动运行构建
   - 会自动部署

### 8.2 查看部署状态

在 Cloudflare Pages 控制台：

1. **Deployments 页面**
   - 查看所有部署历史
   - 查看部署状态
   - 查看构建日志

2. **设置页面**
   - 修改构建配置
   - 查看部署设置

---

## ✅ 完整检查清单

完成所有步骤后，确认：

- [ ] GitHub 仓库包含完整源代码
- [ ] GitHub 仓库包含 `functions/` 文件夹（在根目录）
- [ ] GitHub 仓库不包含 `dist/` 文件夹（已忽略）
- [ ] Cloudflare Pages 配置了构建命令：`npm run build`
- [ ] Cloudflare Pages 配置了构建输出目录：`dist`
- [ ] 构建日志显示构建成功
- [ ] Functions 标签显示 `_middleware.js`
- [ ] 网站能正常访问
- [ ] 所有路由都能正常工作

---

## 🎯 立即开始

### 现在请执行：

1. ✅ **检查 GitHub 仓库内容**
   - 访问 https://github.com/yo385042-blip/mindcube
   - 看看有哪些文件

2. ✅ **推送完整代码**
   - 按照步骤 3 操作

3. ✅ **配置构建命令**
   - 按照步骤 4 操作

4. ✅ **触发重新部署**
   - 按照步骤 5 操作

5. ✅ **验证和测试**
   - 按照步骤 6-7 操作

---

## 💡 提示

- **第一次配置需要时间**，但之后都是自动的
- **每次推送代码都会自动部署**
- **可以在 Cloudflare Pages 查看所有部署历史**
- **可以回滚到之前的部署版本**

完成后告诉我结果，我会帮你验证一切是否正常！

